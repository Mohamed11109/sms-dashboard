<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Raven Dashboard</title>
  <style>
    body { margin:0; font-family:Arial, Helvetica, sans-serif; background:#121212; color:#fff; display:flex; flex-direction:column; }
    header { background:#0d6efd; padding:20px; text-align:center; font-size:28px; font-weight:bold; color:#000; box-shadow:0 2px 8px rgba(0,0,0,0.1); display:flex; justify-content:center; align-items:center; }

    .top-buttons { display:flex; justify-content:center; flex-wrap:wrap; gap:10px; margin:20px 10px; }
    .top-buttons button { padding:12px 25px; background:#0d6efd; color:#fff; border:none; border-radius:6px; font-size:16px; cursor:pointer; transition:0.3s; }
    .top-buttons button:hover { background:#094bb5; transform:translateY(-2px); }

    section { display:none; padding:0 10px 30px 10px; }
    .action-bar { display:flex; flex-wrap:wrap; gap:10px; margin-top:10px; align-items:center; }

    input, select, button.input-btn { padding:10px; margin:5px 0; width:100%; max-width:400px; box-sizing:border-box; border:1px solid #ccc; border-radius:6px; font-size:14px; }
    button.input-btn { background:#0d6efd; color:#fff; border:none; cursor:pointer; }
    button.input-btn:hover { background:#094bb5; }

    table { width:100%; border-collapse:collapse; margin-top:20px; table-layout:fixed; background:#1e1e1e; border-radius:8px; overflow:hidden; box-shadow:0 2px 5px rgba(0,0,0,0.1); }
    th, td { border-bottom:1px solid #333; padding:12px; text-align:center; font-size:14px; color:#fff; }
    th { background:#2c2c2c; font-weight:600; }

    th.no-col, td.no-col { width:40px; }
    th.date-col, td.date-col { width:150px; }
    th.number-col, td.number-col { width:120px; }
    th.status-col, td.status-col { width:120px; }

    th.message-col, td.message-col {
      text-align:left; overflow:hidden; text-overflow:ellipsis; display:-webkit-box; -webkit-line-clamp:3; -webkit-box-orient:vertical; cursor:pointer;
    }

    .status-sent{background:#155724;color:#d4edda;}
    .status-pending{background:#856404;color:#fff3cd;}
    .status-failed{background:#721c24;color:#f8d7da;}

    .modal { display:none; position:fixed; z-index:999; left:0; top:0; width:100%; height:100%; background:rgba(0,0,0,0.5); }
    .modal-content { background:#1e1e1e; margin:15% auto; padding:20px; border-radius:8px; width:90%; max-width:400px; font-size:16px; color:#fff; }
    .close-btn { background:#0d6efd; color:#fff; border:none; padding:8px 15px; border-radius:5px; cursor:pointer; float:right; margin-top:10px; }

    /* Popup notification */
    #sendPopup { display:none; position:fixed; top:50%; left:50%; transform:translate(-50%,-50%); background:#0d6efd; color:#fff; padding:15px 25px; border-radius:8px; font-size:16px; z-index:1000; box-shadow:0 2px 8px rgba(0,0,0,0.3); }

    @media(max-width:768px){ .top-buttons{flex-direction:column;} th,td{font-size:12px;padding:8px;} table{display:block;overflow-x:auto;} }
  </style>
</head>
<body>

<header>Raven Dashboard</header>

<div class="top-buttons">
  <button onclick="showSection('send')">Send SMS</button>
  <button onclick="showSection('receive')">Receive SMS</button>
</div>

<section id="send">
  <h2>Send SMS</h2>
  <div class="action-bar">
    <label for="statusFilter">Filter by Status:</label>
    <select id="statusFilter" onchange="filterByStatus()">
      <option value="all">All</option>
      <option value="Sent">Sent</option>
      <option value="Pending">Pending</option>
      <option value="Failed">Failed</option>
    </select>
    <input type="text" id="messageInput" placeholder="Enter message content" />
    <input type="text" id="numberInput" placeholder="Enter one or more phone numbers" />
    <button class="input-btn" onclick="sendSMS()">Send</button>
    <button class="input-btn" onclick="fetchSent()">Fetch Last 20 Messages</button>
  </div>
  <table>
    <thead>
      <tr>
        <th class="no-col">#</th>
        <th class="date-col">Date & Time</th>
        <th class="message-col">Message</th>
        <th class="status-col">Status</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
</section>

<section id="receive">
  <h2>Received Messages</h2>
  <div class="action-bar">
    <button class="input-btn" onclick="fetchReceived()">Fetch Last 20 Messages</button>
  </div>
  <table>
    <thead>
      <tr>
        <th class="no-col">#</th>
        <th class="date-col">Date & Time</th>
        <th class="number-col">Sender Number</th>
        <th class="message-col">Message</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
</section>

<div id="messageModal" class="modal">
  <div class="modal-content">
    <p id="modalText"></p>
    <button class="close-btn" onclick="closeModal()">Close</button>
  </div>
</div>

<div id="sendPopup">Message successfully sent to device</div>

<script>
let sentCounter = 0;
let recvCounter = 0;

function showSection(id){ 
  document.getElementById('send').style.display='none'; 
  document.getElementById('receive').style.display='none'; 
  document.getElementById(id).style.display='block'; 
}

function nowStr(){ 
  const n=new Date(); 
  return n.getFullYear()+'-'+String(n.getMonth()+1).padStart(2,'0')+'-'+String(n.getDate()).padStart(2,'0')+' '+String(n.getHours()).padStart(2,'0')+':'+String(n.getMinutes()).padStart(2,'0'); 
}

function showSendPopup(){
  const popup = document.getElementById('sendPopup');
  popup.style.display = 'block';
  setTimeout(() => { popup.style.display = 'none'; }, 2000);
}

function sendSMS(){
  const m = messageInput.value.trim();
  const num = numberInput.value.trim();
  if(!m || !num){ alert('Enter message and number'); return; }

  // إضافة الرسالة في جدول الإرسال
  addSent(m,'Pending');
  messageInput.value = '';
  numberInput.value = '';

  // Popup يظهر عند إرسال الرسالة
  showSendPopup();

  // بعد 1.5 ثانية، تحويل الحالة إلى Sent
  setTimeout(() => {
    const row = document.querySelector('#send tbody tr:first-child');
    row.cells[3].textContent = 'Sent';
    row.cells[3].className = 'status-sent';
  }, 1500);

  // بعد 1 ثانية، إضافة رسالة تلقائية في جدول الاستقبال
  setTimeout(() => {
    const count = Math.floor(Math.random()*5 + 1);
    addRecv('Device', `Number of messages to send: ${count}`);
  }, 1000);
}

function addSent(msg,status){ 
  const tb=document.querySelector('#send tbody'); 
  sentCounter++; 
  const r=tb.insertRow(0); 
  r.innerHTML=`<td>${sentCounter}</td><td>${nowStr()}</td><td class='message-col'>${msg}</td><td class='status-${status.toLowerCase()}'>${status}</td>`; 
  r.className=`status-${status.toLowerCase()}`; 
  r.cells[2].onclick=()=>showMessageFull(r.cells[2].textContent); 
}

function addRecv(num,msg){ 
  const tb=document.querySelector('#receive tbody'); 
  recvCounter++; 
  const r=tb.insertRow(0); 
  r.innerHTML=`<td>${recvCounter}</td><td>${nowStr()}</td><td>${num}</td><td class='message-col'>${msg}</td>`; 
  r.cells[3].onclick=()=>showMessageFull(r.cells[3].textContent); 
}

function fetchSent(){ 
  const samples=['System update completed','Delivery report','Balance low','Maintenance notice','Test message from device','Alert: temperature high','Ping from gateway','Scheduled message sent','Backup finished','Heartbeat OK']; 
  const statuses=['Sent','Pending','Failed']; 
  let i=0; const total=20; 
  const t=setInterval(()=>{
    if(i>=total){clearInterval(t); return;} 
    const msg=samples[i%samples.length]; 
    const status=statuses[Math.floor(Math.random()*statuses.length)]; 
    addSent(msg,status); 
    i++; 
  },600); 
}

function fetchReceived(){ 
  const samples=['Hello from device','Status?','Restart now','Check signal','Ping','Emergency alert','Location update','Battery low','Network OK','Command ACK']; 
  let i=0; const total=20; 
  const t=setInterval(()=>{
    if(i>=total){clearInterval(t); return;} 
    addRecv('09'+Math.floor(100000000+Math.random()*899999999), samples[i % samples.length]); 
    i++; 
  },700); 
}

function showMessageFull(t){ 
  modalText.textContent=t; 
  messageModal.style.display='block'; 
}

function closeModal(){ 
  messageModal.style.display='none'; 
}

function filterByStatus(){ 
  const filter=document.getElementById('statusFilter').value; 
  const table=document.querySelector('#send tbody'); 
  Array.from(table.rows).forEach(row=>{
    row.style.display = (filter==='all'||row.cells[3].textContent===filter) ? '' : 'none'; 
  }); 
}

showSection('send');
</script>

</body>
</html>
